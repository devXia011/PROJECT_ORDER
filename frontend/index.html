<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JWT Auth Demo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
</head>
<body class="bg-gray-100 min-h-screen">
  <div id="app">
    <!-- Navigation Bar -->
    <nav v-if="token" class="bg-blue-600 text-white p-4 flex justify-between">
      <span class="font-bold">My Web App</span>
      <span>Welcome, {{ username }}</span>
      <button @click="logout" class="bg-red-500 px-3 py-1 rounded hover:bg-red-600">
        Logout
      </button>
    </nav>

    <!-- Main Content -->
    <div class="flex items-center justify-center min-h-screen">
      <!-- Login Form -->
      <div v-if="!token" class="w-full max-w-md p-6 bg-white rounded shadow">
        <h1 class="text-2xl font-bold mb-4">Login</h1>
        <input v-model="username" type="text" placeholder="Username"
               class="w-full p-2 mb-3 border rounded" />
        <input v-model="password" type="password" placeholder="Password"
               class="w-full p-2 mb-3 border rounded" />
        <button @click="login"
                class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600">
          Login
        </button>
        <p v-if="error" class="text-red-500 mt-2">{{ error }}</p>
      </div>

      <!-- Profile Page -->
      <div v-else class="w-full max-w-lg p-6 bg-white rounded shadow">
        <h1 class="text-2xl font-bold mb-4">Profile Page</h1>
        <p class="text-gray-700 mb-4">You are logged in as <strong>{{ username }}</strong>.</p>
        <button @click="fetchProtected"
                class="bg-green-500 text-white py-2 px-4 rounded hover:bg-green-600">
          Access Protected Route
        </button>
        <p v-if="message" class="mt-4 text-gray-700">{{ message }}</p>
      </div>
    </div>
  </div>

  <script>
    const { createApp } = Vue
    createApp({
      data() {
        return {
          username: '',
          password: '',
          token: localStorage.getItem("token") || null,
          error: null,
          message: null
        }
      },
      methods: {
        async login() {
          this.error = null
          try {
            const res = await fetch("/login", {
              method: "POST",
              headers: { "Content-Type": "application/x-www-form-urlencoded" },
              body: new URLSearchParams({ username: this.username, password: this.password })
            })
            if (!res.ok) throw new Error("Invalid credentials")
            const data = await res.json()
            this.token = data.access_token
            localStorage.setItem("token", this.token)
          } catch (err) { this.error = err.message }
        },
        async fetchProtected() {
          const res = await fetch("/protected", {
            headers: { Authorization: `Bearer ${this.token}` }
          })
          this.message = res.ok ? (await res.json()).message : "Access denied"
        },
        logout() {
          this.token = null
          localStorage.removeItem("token")
          this.message = null
          this.password = ''
        }
      }
    }).mount('#app')
  </script>
</body>
</html>